# REST API для сервиса **YamDb** 
версия c Docker, Continuous Integration на GitHub Actions

## Описание

Проект **YaMDb** собирает отзывы пользователей на произведения. 
Произведения делятся на категории: «Книги», «Фильмы», «Музыка». 
Список категорий (Category) может быть расширен.

### API для сервиса YaMDb 
позволяет работать со следующими сущностями:

**Пользователи** (Получить список всех пользователей, создание пользователя, получить пользователя по username, изменить данные пользователя по username, удалить пользователя по username, получить данные своей учетной записи, изменить данные своей учетной записи)

**Произведения**, к которым пишут отзывы (Получить список всех объектов, создать произведение для отзывов, информация об объекте, обновить информацию об объекте, удалить произведение)

**Категории** (типы) произведений (Получить список всех категорий, создать категорию, удалить категорию)

**Жанры** (Получить список всех жанров, создать жанр, удалить жанр)

**Отзывы** (Получить список всех отзывов, создать новый отзыв, получить отзыв по id, частично обновить отзыв по id, удалить отзыв по id)

**Коментарии к отзывам** (Получить список всех комментариев к отзыву по id, создать новый комментарий для отзыва, получить комментарий для отзыва по id, частично обновить комментарий к отзыву по id, удалить комментарий к отзыву по id)

**JWT-токен** (Отправление confirmation_code на переданный email, получение JWT-токена в обмен на email и confirmation_code)

### Алгоритм регистрации пользователей

* Пользователь отправляет запрос с параметром email на /auth/email/.
* YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email .
* Пользователь отправляет запрос с параметрами email и confirmation_code на /auth/token/, в ответе на запрос ему приходит token (JWT-токен).
* При желании пользователь отправляет PATCH-запрос на /users/me/ и заполняет поля в своём профайле (описание полей — в документации).

####  Как запустить проект:
```
cd /d/dev
```

Клонировать репозиторий и перейти в него в командной строке:

```
git clone git@github.com:asp781/yamdb_final.git

```
## Создать переменные окружения в разделе `secrets` настроек текущего репозитория:

- DOCKER_PASSWORD # Пароль от Docker Hub
- DOCKER_USERNAME # Логин от Docker Hub
- HOST # Публичный ip адрес сервера
- USER # Пользователь зарегистрированный на сервере
- PASSPHRASE # Если ssh-ключ защищен фразой-паролем
- SSH_KEY # Приватный ssh-ключ
- TELEGRAM_TO # ID телеграм-аккаунта
- TELEGRAM_TOKEN # Токен бота

- DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
- DB_NAME=postgres # имя базы данных
- POSTGRES_USER=postgres # логин для подключения к базе данных
- POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
- DB_HOST=db # название сервиса (контейнера)
- DB_PORT=5432 # порт для подключения к БД 

Выполнить миграции:

```
sudo docker-compose exec web python manage.py migrate
```

Создать суперпользователя:

```
sudo docker-compose exec web python manage.py createsuperuser
```

Собрать статику:

```
sudo docker-compose exec web python manage.py collectstatic --no-input
```
Наполнить базу данных:

```
sudo docker-compose exec web python manage.py loaddata fixtures.json
```
## Теперь проект доступен по адресу:
- http://asp781.ddns.net/api/v1/
- http://asp781.ddns.net/admin/

## После каждого обновления репозитория (`git push`) будет происходить:
1. Проверка кода на соответствие стандарту PEP8 (с помощью пакета flake8) и запуск pytest из репозитория yamdb_final
2. Сборка и доставка докер-образов на Docker Hub.
3. Автоматический деплой.
4. Отправка уведомления в Telegram.

## Технологии:
- Python 3.8
- Django 2.2.19
- djangorestframework 3.12.4
- Docker
- NGINX
- GUNICORN
- POSTGRES

Автор проекта: [Алексей Спесивцев](https://github.com/asp781/)

http://51.250.68.182/redoc/

![yamdb_workflow](https://github.com/asp781/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg?event=push)
